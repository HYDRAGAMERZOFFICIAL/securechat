(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2019:(e,s,t)=>{Promise.resolve().then(t.bind(t,5354))},5354:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>e5});var a=t(5155),r=t(385),l=t(2115),n=t(9271),i=t(4947),d=t(3831),c=t(6293),o=t(9631),u=t(2823),m=t(1825),x=t(853),f=t(7058),h=t(5812);let p=[],j=[];var g=t(1567),v=t(2317),N=t(1027);let b=(0,N.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),w=l.forwardRef((e,s)=>{let{className:t,variant:r,size:l,asChild:n=!1,...i}=e,d=n?v.DX:"button";return(0,a.jsx)(d,{className:(0,g.cn)(b({variant:r,size:l,className:t})),ref:s,...i})});w.displayName="Button";let y=l.forwardRef((e,s)=>{let{className:t,type:r,...l}=e;return(0,a.jsx)("input",{type:r,className:(0,g.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...l})});y.displayName="Input";var C=t(9710);let A=C.Kq,k=C.bL,S=C.l9,R=l.forwardRef((e,s)=>{let{className:t,sideOffset:r=4,...l}=e;return(0,a.jsx)(C.UC,{ref:s,sideOffset:r,className:(0,g.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...l})});R.displayName=C.UC.displayName;var z=t(1856);let P=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(z.bL,{ref:s,className:(0,g.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...r})});P.displayName=z.bL.displayName;let L=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(z._V,{ref:s,className:(0,g.cn)("aspect-square h-full w-full object-cover",t),...r})});L.displayName=z._V.displayName;let D=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(z.H4,{ref:s,className:(0,g.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...r})});D.displayName=z.H4.displayName;var M=t(1466);function T(e){let{src:s,name:t,className:r}=e;return(0,a.jsxs)(P,{className:(0,g.cn)("ring-2 ring-background",r),children:[(0,a.jsx)(L,{src:s,alt:t,className:"object-cover"}),(0,a.jsx)(D,{children:t?t.split(" ").map(e=>e[0]).join("").toUpperCase():(0,a.jsx)(M.A,{className:"h-5 w-5"})})]})}var U=t(1868);let F=l.forwardRef((e,s)=>{let{className:t,children:r,...l}=e;return(0,a.jsxs)(U.bL,{ref:s,className:(0,g.cn)("relative overflow-hidden",t),...l,children:[(0,a.jsx)(U.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,a.jsx)(I,{}),(0,a.jsx)(U.OK,{})]})});F.displayName=U.bL.displayName;let I=l.forwardRef((e,s)=>{let{className:t,orientation:r="vertical",...l}=e;return(0,a.jsx)(U.VM,{ref:s,orientation:r,className:(0,g.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...l,children:(0,a.jsx)(U.lr,{className:"relative flex-1 rounded-full bg-border"})})});I.displayName=U.VM.displayName;let _=(0,N.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function O(e){let{className:s,variant:t,...r}=e;return(0,a.jsx)("div",{className:(0,g.cn)(_({variant:t}),s),...r})}var V=t(4906),E=t(8867),J=t(76);function G(e){let{chats:s,selectedChat:t,onSelectChat:n,isLoading:i}=e,{user:d}=(0,r.useUser)(),c=(0,r.useFirestore)(),o=(0,r.useMemoFirebase)(()=>(0,f.P)((0,f.rJ)(c,"users")),[c]),{data:u}=(0,r.useCollection)(o),m=(0,l.useMemo)(()=>{let e=new Map;return null==u||u.forEach(s=>e.set(s.id,s)),e},[u]),x=e=>{if(!e||e.senderId!==(null==d?void 0:d.uid))return null;let s="h-4 w-4 mr-1";return"read"===e.status?(0,a.jsx)(V.A,{className:(0,g.cn)(s,"text-primary")}):"delivered"===e.status?(0,a.jsx)(V.A,{className:s}):(0,a.jsx)(E.A,{className:s})},h=e=>{if(!e)return"";try{let s=e.toDate();return(0,J.m)(s,{addSuffix:!0})}catch(s){if("string"==typeof e)try{let s=new Date(e);if(!isNaN(s.getTime()))return(0,J.m)(s,{addSuffix:!0})}catch(e){}return"just now"}},p=e=>e?"function"==typeof e.toDate?e.toDate().getTime():e instanceof Date?e.getTime():new Date(e).getTime()||0:0;return i?(0,a.jsx)("div",{className:"p-4 space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"h-12 w-12 rounded-full bg-muted animate-pulse"}),(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)("div",{className:"h-4 w-3/4 rounded bg-muted animate-pulse"}),(0,a.jsx)("div",{className:"h-4 w-1/2 rounded bg-muted animate-pulse"})]})]},s))}):(0,a.jsx)(F,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-2",children:s.sort((e,s)=>p(s.lastMessageTimestamp)-p(e.lastMessageTimestamp)).map(e=>{var s;let r=null===(s=e.messages)||void 0===s?void 0:s[e.messages.length-1],l=e.name,i=e.avatar;if("private"===e.type){let s=e.members.find(e=>e!==(null==d?void 0:d.uid)),t=s?m.get(s):void 0;t&&(l=t.username,i=t.profilePicture)}return(0,a.jsxs)("button",{onClick:()=>n(e),className:(0,g.cn)("flex items-center gap-3 w-full p-2 rounded-lg text-left transition-colors",(null==t?void 0:t.id)===e.id?"bg-accent text-accent-foreground":"hover:bg-muted"),children:[(0,a.jsx)(T,{src:i,name:l,className:"h-12 w-12"}),(0,a.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-semibold truncate",children:l}),e.lastMessageTimestamp&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground flex-shrink-0",children:h(e.lastMessageTimestamp)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,a.jsxs)("p",{className:"text-sm text-muted-foreground truncate flex items-center",children:[x(r),e.lastMessage||"No messages yet"]}),e.unreadCount>0&&(0,a.jsx)(O,{variant:"default",className:"flex-shrink-0",children:e.unreadCount})]})]})]},e.id)})})})}var H=t(7364),q=t(7820),B=t(8291),Z=t(3963),W=t(3817),K=t(5843),X=t(5015),Y=t(2316),Q=t(4081),$=t(8283),ee=t(7280);function es(e){let{message:s,sender:t}=e,{user:l}=(0,r.useUser)(),n=s.senderId===(null==l?void 0:l.uid);return(0,a.jsxs)("div",{className:(0,g.cn)("flex items-end gap-2 max-w-[75%]",n?"ml-auto flex-row-reverse":"mr-auto"),children:[!n&&(0,a.jsx)(T,{src:null==t?void 0:t.avatar,name:null==t?void 0:t.name,className:"h-8 w-8"}),(0,a.jsxs)("div",{className:(0,g.cn)("rounded-xl px-4 py-2",n?"bg-primary text-primary-foreground rounded-br-none":"bg-card text-card-foreground rounded-bl-none border"),children:[!n&&t&&(0,a.jsx)("p",{className:"text-xs font-semibold text-primary mb-1",children:t.name}),(0,a.jsx)("p",{className:"text-base whitespace-pre-wrap break-words",children:s.text}),(0,a.jsxs)("div",{className:"flex items-center justify-end mt-1",children:[(0,a.jsx)("span",{className:"text-xs text-muted-foreground/80",children:(e=>{if(!e)return"";try{let s=e.toDate?e.toDate():e instanceof Date?e:new Date(e);return(0,ee.GP)(s,"HH:mm")}catch(e){return""}})(s.timestamp)}),(()=>{if(!n)return null;let e="h-4 w-4 ml-1.5 flex-shrink-0";return"read"===s.status?(0,a.jsx)(V.A,{className:(0,g.cn)(e,"text-blue-500")}):"delivered"===s.status?(0,a.jsx)(V.A,{className:(0,g.cn)(e,"text-muted-foreground")}):(0,a.jsx)(E.A,{className:(0,g.cn)(e,"text-muted-foreground")})})()]})]})]})}let et=(0,N.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),ea=l.forwardRef((e,s)=>{let{className:t,variant:r,...l}=e;return(0,a.jsx)("div",{ref:s,role:"alert",className:(0,g.cn)(et({variant:r}),t),...l})});ea.displayName="Alert";let er=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("h5",{ref:s,className:(0,g.cn)("mb-1 font-medium leading-none tracking-tight",t),...r})});er.displayName="AlertTitle";let el=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,g.cn)("text-sm [&_p]:leading-relaxed",t),...r})});el.displayName="AlertDescription";var en=t(4471),ei=t(6967),ed=t(3565);let ec=en.bL,eo=en.l9;en.YJ,en.ZL,en.Pb,en.z6,l.forwardRef((e,s)=>{let{className:t,inset:r,children:l,...n}=e;return(0,a.jsxs)(en.ZP,{ref:s,className:(0,g.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",t),...n,children:[l,(0,a.jsx)(ei.A,{className:"ml-auto"})]})}).displayName=en.ZP.displayName,l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(en.G5,{ref:s,className:(0,g.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})}).displayName=en.G5.displayName;let eu=l.forwardRef((e,s)=>{let{className:t,sideOffset:r=4,...l}=e;return(0,a.jsx)(en.ZL,{children:(0,a.jsx)(en.UC,{ref:s,sideOffset:r,className:(0,g.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...l})})});eu.displayName=en.UC.displayName;let em=l.forwardRef((e,s)=>{let{className:t,inset:r,...l}=e;return(0,a.jsx)(en.q7,{ref:s,className:(0,g.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",t),...l})});em.displayName=en.q7.displayName,l.forwardRef((e,s)=>{let{className:t,children:r,checked:l,...n}=e;return(0,a.jsxs)(en.H_,{ref:s,className:(0,g.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:l,...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(en.VF,{children:(0,a.jsx)(E.A,{className:"h-4 w-4"})})}),r]})}).displayName=en.H_.displayName,l.forwardRef((e,s)=>{let{className:t,children:r,...l}=e;return(0,a.jsxs)(en.hN,{ref:s,className:(0,g.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(en.VF,{children:(0,a.jsx)(ed.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=en.hN.displayName,l.forwardRef((e,s)=>{let{className:t,inset:r,...l}=e;return(0,a.jsx)(en.JU,{ref:s,className:(0,g.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",t),...l})}).displayName=en.JU.displayName;let ex=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(en.wv,{ref:s,className:(0,g.cn)("-mx-1 my-1 h-px bg-muted",t),...r})});function ef(e){var s,t,n;let{chat:i,onClose:o,onSendMessage:u,allUsers:m}=e,[x,h]=(0,l.useState)(""),{user:p}=(0,r.useUser)(),j=(0,r.useFirestore)(),g=(0,r.useMemoFirebase)(()=>i?(0,f.P)((0,f.rJ)(j,"chats",i.id,"messages"),(0,f.My)("timestamp","asc")):null,[j,i]),{data:v,isLoading:N}=(0,r.useCollection)(g),b=(0,l.useMemo)(()=>{let e=new Map;return i.members&&i.members.forEach(s=>{let t=m.get(s);t&&e.set(s,{name:t.username,avatar:t.profilePicture})}),e},[i.members,m]),C=e=>{if(!e)return"";if(e&&"function"==typeof e.toDate)return(0,ee.GP)(e.toDate(),"p");try{let s=new Date(e);if(!isNaN(s.getTime()))return(0,ee.GP)(s,"p")}catch(e){}return String(e)},A="private"===i.type?null===(s=m.get(i.members.find(e=>e!==(null==p?void 0:p.uid))))||void 0===s?void 0:s.username:i.name,k="private"===i.type?null===(t=m.get(i.members.find(e=>e!==(null==p?void 0:p.uid))))||void 0===t?void 0:t.profilePicture:i.avatar;return(0,a.jsxs)("div",{className:"flex flex-col h-full bg-card w-full",children:[(0,a.jsxs)("header",{className:"flex items-center p-3 border-b border-border",children:[(0,a.jsx)(w,{variant:"ghost",size:"icon",className:"mr-2 md:hidden",onClick:o,children:(0,a.jsx)(H.A,{})}),(0,a.jsx)(T,{src:k,name:A,className:"h-10 w-10"}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h2",{className:"font-semibold text-lg",children:A}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"group"===i.type?"".concat(null===(n=i.members)||void 0===n?void 0:n.length," members"):"online"})]}),(0,a.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,a.jsx)(w,{variant:"ghost",size:"icon",className:"rounded-full h-10 w-10",children:(0,a.jsx)(q.A,{})}),(0,a.jsx)(w,{variant:"ghost",size:"icon",className:"rounded-full h-10 w-10",children:(0,a.jsx)(d.A,{})}),(0,a.jsxs)(ec,{children:[(0,a.jsx)(eo,{asChild:!0,children:(0,a.jsx)(w,{variant:"ghost",size:"icon",className:"rounded-full h-10 w-10",children:(0,a.jsx)(c.A,{})})}),(0,a.jsxs)(eu,{align:"end",children:[(0,a.jsx)(em,{children:"View Contact"}),(0,a.jsx)(em,{children:"Search"}),(0,a.jsx)(ex,{}),(0,a.jsxs)(em,{className:"text-destructive",children:[(0,a.jsx)(B.A,{className:"mr-2 h-4 w-4"}),"Block"]}),(0,a.jsxs)(em,{className:"text-destructive",children:[(0,a.jsx)(Z.A,{className:"mr-2 h-4 w-4"}),"Report"]})]})]})]})]}),(0,a.jsx)(F,{className:"flex-1 bg-secondary/30",children:(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsxs)(ea,{className:"bg-accent/20 border-accent/30",children:[(0,a.jsx)(W.A,{className:"h-4 w-4 text-accent"}),(0,a.jsx)(er,{className:"text-sm font-semibold text-accent",children:"End-to-end Encrypted"}),(0,a.jsx)(el,{className:"text-xs text-accent/80",children:"Messages and calls are secured. No one outside of this chat, not even SecureChat, can read or listen to them."})]}),N&&(0,a.jsx)("p",{children:"Loading messages..."}),null==v?void 0:v.map(e=>(0,a.jsx)(es,{message:{...e,timestamp:C(e.timestamp)},sender:b.get(e.senderId)},e.id))]})}),(0,a.jsx)("footer",{className:"p-3 border-t border-border",children:(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),""!==x.trim()&&(u(x),h(""))},className:"flex items-center gap-2",children:[(0,a.jsx)(w,{type:"button",variant:"ghost",size:"icon",className:"rounded-full h-10 w-10",children:(0,a.jsx)(K.A,{})}),(0,a.jsxs)(ec,{children:[(0,a.jsx)(eo,{asChild:!0,children:(0,a.jsx)(w,{type:"button",variant:"ghost",size:"icon",className:"rounded-full h-10 w-10",children:(0,a.jsx)(X.A,{})})}),(0,a.jsxs)(eu,{children:[(0,a.jsxs)(em,{children:[(0,a.jsx)(Y.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Photo or Video"})]}),(0,a.jsxs)(em,{children:[(0,a.jsx)(Q.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Document"})]})]})]}),(0,a.jsx)(y,{placeholder:"Type a message...",className:"flex-1 rounded-full px-4",value:x,onChange:e=>h(e.target.value)}),(0,a.jsx)(w,{type:"submit",size:"icon",className:"rounded-full h-10 w-10 bg-primary hover:bg-primary/90",children:(0,a.jsx)($.A,{})})]})})]})}ex.displayName=en.wv.displayName;var eh=t(3473);let ep=p.find(e=>"user-2"===e.id);function ej(e){let{statuses:s,onViewStatus:t}=e,r=s.reduce((e,s)=>(e[s.userId]||(e[s.userId]=[]),e[s.userId].push(s),e),{}),l=Object.values(r).map(e=>e[e.length-1]).filter(e=>e.userId!==(null==ep?void 0:ep.id)).sort((e,s)=>new Date(s.timestamp).getTime()-new Date(e.timestamp).getTime());return(0,a.jsx)(F,{className:"flex-1",children:(0,a.jsxs)("div",{className:"p-2 space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg cursor-pointer hover:bg-muted",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(T,{src:null==ep?void 0:ep.avatar,name:null==ep?void 0:ep.name,className:"h-12 w-12"}),(0,a.jsx)("div",{className:"absolute bottom-0 right-0 bg-primary text-primary-foreground rounded-full h-5 w-5 flex items-center justify-center border-2 border-background",children:(0,a.jsx)(eh.A,{className:"h-3 w-3"})})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold",children:"My status"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Add to my status"})]})]}),(0,a.jsx)("h4",{className:"px-3 pt-4 pb-2 text-sm font-semibold text-muted-foreground",children:"Recent updates"}),l.map(e=>{let s=p.find(s=>s.id===e.userId);if(!s)return null;let l=r[s.id].some(e=>!e.viewed);return(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg cursor-pointer hover:bg-muted",onClick:()=>t(s.id),children:[(0,a.jsx)("div",{className:(0,g.cn)("p-0.5 rounded-full",l?"bg-gradient-to-tr from-yellow-400 to-pink-500":"bg-muted"),children:(0,a.jsx)("div",{className:"p-0.5 bg-background rounded-full",children:(0,a.jsx)(T,{src:s.avatar,name:s.name,className:"h-12 w-12"})})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold",children:s.name}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},e.id)})]})})}var eg=t(770),ev=t(2048),eN=t(3723);let eb=e=>{let s=e.find(e=>"user-2"!==e);return p.find(e=>e.id===s)};function ew(e){let{calls:s}=e;return(0,a.jsx)(F,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-2 space-y-1",children:s.map(e=>{let s=eb(e.participantIds);if(!s)return null;let t="missed"===e.status,r="video"===e.type?q.A:"incoming"===e.direction?eg.A:ev.A;return(0,a.jsxs)("div",{className:(0,g.cn)("flex items-center gap-3 p-2 rounded-lg cursor-pointer hover:bg-muted"),children:[(0,a.jsx)(T,{src:s.avatar,name:s.name,className:"h-12 w-12"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:(0,g.cn)("font-semibold",t&&"text-destructive"),children:s.name}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:["missed"===e.status?(0,a.jsx)(eN.A,{className:(0,g.cn)("h-4 w-4",t&&"text-destructive")}):(0,a.jsx)(r,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"outgoing"===e.direction?"Outgoing":"Incoming"})]})]}),(0,a.jsxs)("div",{className:"text-right",children:["video"===e.type?(0,a.jsx)(q.A,{className:"h-5 w-5 text-primary"}):(0,a.jsx)(d.A,{className:"h-5 w-5 text-primary"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:e.timestamp})]})]},e.id)})})})}var ey=t(3518),eC=t(767),eA=t(3057);let ek=l.forwardRef((e,s)=>{let{className:t,value:r,...l}=e;return(0,a.jsx)(eA.bL,{ref:s,className:(0,g.cn)("relative h-1 w-full overflow-hidden rounded-full bg-white/20",t),...l,children:(0,a.jsx)(eA.C1,{className:"h-full w-full flex-1 bg-white transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});function eS(e){var s;let{statuses:t,onClose:r}=e,[n,i]=(0,l.useState)(0),[d,c]=(0,l.useState)(0),[o,u]=(0,l.useState)(0),m=(0,l.useRef)(null),x=(0,l.useRef)(null),f=p.filter(e=>t.some(s=>s.userId===e.id)),h=null===(s=f[n])||void 0===s?void 0:s.id,j=t.filter(e=>e.userId===h),g=j[d],v=p.find(e=>e.id===(null==g?void 0:g.userId)),N=()=>{m.current&&clearTimeout(m.current),x.current&&clearInterval(x.current),u(0)},b=()=>{N(),d<j.length-1?c(d+1):n<f.length-1?(i(n+1),c(0)):r()};(0,l.useEffect)(()=>{if(!g)return;let e=1e3*g.duration;m.current=setTimeout(b,e);let s=Date.now();return x.current=setInterval(()=>{let t=(Date.now()-s)/e*100;t<=100?u(t):x.current&&clearInterval(x.current)},50),()=>{N()}},[g,n,d]);let w=e=>{e.stopPropagation(),N(),d>0?c(d-1):n>0&&(i(n-1),c(t.filter(e=>e.userId===f[n-1].id).length-1))},y=e=>{e.stopPropagation(),b()};return v&&g?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center z-50",onClick:r,children:(0,a.jsxs)("div",{className:"relative w-full h-full max-w-lg max-h-screen flex flex-col items-center justify-center",children:[(0,a.jsx)("button",{onClick:w,className:"absolute left-2 top-1/2 -translate-y-1/2 z-20 text-white p-2 bg-black/20 rounded-full",children:(0,a.jsx)(ey.A,{size:24})}),(0,a.jsx)("button",{onClick:y,className:"absolute right-2 top-1/2 -translate-y-1/2 z-20 text-white p-2 bg-black/20 rounded-full",children:(0,a.jsx)(ei.A,{size:24})}),(0,a.jsxs)("div",{className:"absolute top-0 left-0 right-0 p-4 z-20",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-2",children:j.map((e,s)=>(0,a.jsx)(ek,{value:s<d?100:s===d?o:0,className:"h-1 flex-1"},s))}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(T,{src:v.avatar,name:v.name,className:"h-10 w-10"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-white",children:v.name}),(0,a.jsx)("p",{className:"text-xs text-neutral-300",children:new Date(g.timestamp).toLocaleTimeString()})]})]}),(0,a.jsx)("button",{onClick:r,className:"text-white",children:(0,a.jsx)(eC.A,{size:24})})]})]}),(0,a.jsx)("img",{src:g.imageUrl,alt:"Status from ".concat(v.name),className:"object-contain max-w-full max-h-full rounded-lg",onClick:e=>{let s=e.currentTarget.getBoundingClientRect();e.clientX-s.left<s.width/3?w(e):y(e)}})]})}):null}function eR(e){let{users:s,onSelectUser:t,onClose:n}=e,{user:i}=(0,r.useUser)(),[d,c]=(0,l.useState)(""),o=s.filter(e=>e.id!==(null==i?void 0:i.uid)).filter(e=>{var s;return null===(s=e.username)||void 0===s?void 0:s.toLowerCase().includes(d.toLowerCase())});return(0,a.jsxs)("div",{className:"flex flex-col h-full bg-card",children:[(0,a.jsxs)("header",{className:"p-3 border-b border-border flex items-center",children:[(0,a.jsx)(w,{variant:"ghost",size:"icon",className:"mr-2",onClick:n,children:(0,a.jsx)(H.A,{})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"New Chat"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Select a contact to start a chat"})]})]}),(0,a.jsx)("div",{className:"p-3 border-b border-border",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),(0,a.jsx)(y,{placeholder:"Search contacts...",className:"pl-10 bg-background",value:d,onChange:e=>c(e.target.value)})]})}),(0,a.jsx)(F,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-2",children:o.map(e=>(0,a.jsxs)("div",{onClick:()=>t(e),className:"flex items-center gap-3 w-full p-2 rounded-lg text-left transition-colors hover:bg-muted cursor-pointer",children:[(0,a.jsx)(T,{src:e.profilePicture,name:e.username,className:"h-12 w-12"}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,a.jsx)("h3",{className:"font-semibold truncate",children:e.username})})]},e.id))})})]})}ek.displayName=eA.bL.displayName;var ez=t(1190);function eP(e){let{users:s,onCreateGroup:t,onClose:n}=e,{user:i}=(0,r.useUser)(),[d,c]=(0,l.useState)(""),[o,m]=(0,l.useState)(null),[h,p]=(0,l.useState)([]),j=(0,l.useRef)(null),[g,v]=(0,l.useState)(""),N=e=>{p(s=>s.find(s=>s.id===e.id)?s.filter(s=>s.id!==e.id):[...s,e])},b=s.filter(e=>e.id!==(null==i?void 0:i.uid)).filter(e=>{var s;return null===(s=e.username)||void 0===s?void 0:s.toLowerCase().includes(g.toLowerCase())});return(0,a.jsxs)("div",{className:"flex flex-col h-full bg-card",children:[(0,a.jsxs)("header",{className:"p-3 border-b border-border flex items-center",children:[(0,a.jsx)(w,{variant:"ghost",size:"icon",className:"mr-2",onClick:n,children:(0,a.jsx)(H.A,{})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"New Group"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Add subject and select members"})]})]}),(0,a.jsx)("div",{className:"p-4 space-y-4 border-b",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(P,{className:"w-16 h-16 text-3xl",children:[(0,a.jsx)(L,{src:null!=o?o:void 0}),(0,a.jsx)(D,{children:(0,a.jsx)(u.A,{})})]}),(0,a.jsx)(w,{type:"button",size:"icon",variant:"secondary",className:"absolute bottom-0 right-0 rounded-full h-6 w-6",onClick:()=>{var e;return null===(e=j.current)||void 0===e?void 0:e.click()},children:(0,a.jsx)(ez.A,{className:"w-3 h-3"})}),(0,a.jsx)("input",{type:"file",ref:j,className:"hidden",accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files[0]){let s=new FileReader;s.onload=e=>{var s;m(null===(s=e.target)||void 0===s?void 0:s.result)},s.readAsDataURL(e.target.files[0])}}})]}),(0,a.jsx)(y,{placeholder:"Group Subject",value:d,onChange:e=>c(e.target.value),className:"text-lg"})]})}),(0,a.jsx)("div",{className:"p-3 border-b border-border",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),(0,a.jsx)(y,{placeholder:"Search contacts...",className:"pl-10 bg-background",value:g,onChange:e=>v(e.target.value)})]})}),(0,a.jsx)(F,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-2",children:b.map(e=>(0,a.jsxs)("div",{onClick:()=>N(e),className:"flex items-center gap-3 w-full p-2 rounded-lg text-left transition-colors hover:bg-muted cursor-pointer",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(T,{src:e.profilePicture,name:e.username,className:"h-12 w-12"}),h.find(s=>s.id===e.id)&&(0,a.jsx)("div",{className:"absolute bottom-0 right-0 bg-primary rounded-full p-0.5",children:(0,a.jsx)(E.A,{className:"h-3 w-3 text-primary-foreground"})})]}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,a.jsx)("h3",{className:"font-semibold truncate",children:e.username})})]},e.id))})}),h.length>0&&(0,a.jsx)("footer",{className:"p-4 bg-card border-t",children:(0,a.jsxs)(w,{className:"w-full",onClick:()=>{d.trim()&&h.length>0&&i&&t({type:"group",name:d,avatar:o||"https://ui-avatars.com/api/?name=".concat(encodeURIComponent(d),"&background=random"),members:[i.uid,...h.map(e=>e.id)],lastMessage:"Group created",lastMessageTimestamp:(0,f.O5)()})},disabled:!d.trim(),children:["Create Group (",h.length," selected)"]})})]})}var eL=t(7568),eD=t(6954);function eM(e){let{onClose:s}=e;return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("header",{className:"p-3 border-b border-border flex items-center bg-card",children:[(0,a.jsx)(w,{variant:"ghost",size:"icon",className:"mr-2",onClick:s,children:(0,a.jsx)(H.A,{})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Linked Devices"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Manage your connected devices"})]})]}),(0,a.jsxs)("div",{className:"p-6 text-center border-b",children:[(0,a.jsx)("div",{className:"flex justify-center mb-4",children:(0,a.jsx)(eL.A,{className:"h-24 w-24 text-muted-foreground"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Link a new device"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Scan this code with your phone to log in instantly."}),(0,a.jsx)(w,{children:"Link a Device"})]}),(0,a.jsx)(F,{className:"flex-1",children:(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-muted-foreground px-2",children:"Device List"}),[{type:"desktop",name:"MacOS",location:"San Francisco, US",lastActive:"now",isCurrent:!0},{type:"mobile",name:"Pixel 8 Pro",location:"San Francisco, US",lastActive:"2 hours ago",isCurrent:!1}].map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center gap-4 p-2 rounded-lg hover:bg-muted",children:["desktop"===e.type?(0,a.jsx)(m.A,{className:"h-8 w-8 text-muted-foreground"}):(0,a.jsx)(eD.A,{className:"h-8 w-8 text-muted-foreground"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.location," â€¢ ",e.isCurrent?(0,a.jsx)("span",{className:"text-green-500",children:"Active now"}):"Last active ".concat(e.lastActive)]})]}),!e.isCurrent&&(0,a.jsxs)(ec,{children:[(0,a.jsx)(eo,{asChild:!0,children:(0,a.jsx)(w,{variant:"ghost",size:"icon",children:(0,a.jsx)(c.A,{className:"h-4 w-4"})})}),(0,a.jsx)(eu,{align:"end",children:(0,a.jsx)(em,{className:"text-destructive",children:"Log out"})})]})]},s))]})})]})}function eT(e){var s,t;let{onSignOut:p}=e,{user:v}=(0,r.useUser)(),N=(0,r.useFirestore)(),[b,C]=(0,l.useState)("chats"),[z,P]=(0,l.useState)(null),[L,D]=(0,l.useState)(null),M=(0,r.useMemoFirebase)(()=>v?(0,f.P)((0,f.rJ)(N,"chats"),(0,f._M)("members","array-contains",v.uid)):null,[N,v]),{data:U,isLoading:F}=(0,r.useCollection)(M),I=(0,r.useMemoFirebase)(()=>(0,f.P)((0,f.rJ)(N,"users")),[N]),{data:_,isLoading:V}=(0,r.useCollection)(I),E=null==U?void 0:U.find(e=>e.id===z),J=(0,l.useMemo)(()=>U?U.reduce((e,s)=>e+(s.unreadCount||0),0):0,[U]),H=async e=>{if(!v)return;let s=(0,f.P)((0,f.rJ)(N,"chats"),(0,f._M)("type","==","private"),(0,f._M)("members","in",[[v.uid,e.id],[e.id,v.uid]])),t=await (0,f.GG)(s);if(t.empty){let s={type:"private",name:e.username,avatar:e.profilePicture,members:[e.id,v.uid],unreadCount:0,lastMessage:null,lastMessageTimestamp:null};P((await (0,f.gS)((0,f.rJ)(N,"chats"),s)).id)}else P(t.docs[0].id);C("chats")},q=e=>{let{id:s,icon:t,tooltip:r,badgeCount:l}=e;return(0,a.jsx)(A,{children:(0,a.jsxs)(k,{children:[(0,a.jsx)(S,{asChild:!0,children:(0,a.jsxs)(w,{variant:"ghost",size:"icon",className:(0,g.cn)("rounded-full h-10 w-10 relative",b===s?"bg-accent text-accent-foreground":"text-muted-foreground"),onClick:()=>{C(s),P(null)},children:[t,l&&l>0&&(0,a.jsx)(O,{className:"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0",children:l})]})}),(0,a.jsx)(R,{side:"right",children:(0,a.jsx)("p",{children:r})})]})})},B=(0,l.useMemo)(()=>{let e=new Map;return _&&_.forEach(s=>e.set(s.id,s)),v&&!e.has(v.uid)&&e.set(v.uid,{id:v.uid,username:v.displayName,profilePicture:v.photoURL,name:v.displayName,avatar:v.photoURL,online:!0}),e},[_,v]),Z=(0,l.useMemo)(()=>{if(!E)return null;let e=E.members.filter(e=>e!==(null==v?void 0:v.uid)),s=E.name,t=E.avatar;if("private"===E.type&&e.length>0){let a=B.get(e[0]);a&&(s=a.username,t=a.profilePicture)}return{...E,name:s,avatar:t}},[E,B,v]);return L?(0,a.jsx)(eS,{statuses:L,onClose:()=>{D(null)}}):(0,a.jsxs)("div",{className:"flex w-full h-screen",children:[(0,a.jsx)("div",{className:(0,g.cn)("flex flex-col border-r border-border transition-all duration-300 bg-card",z&&"chats"===b?"w-full md:w-[30%] md:max-w-sm":"w-full",!(z&&"chats"===b)&&"md:w-full",z&&"chats"===b&&"hidden md:flex"),children:"new-chat"===b?(0,a.jsx)(eR,{users:_||[],onSelectUser:H,onClose:()=>C("chats")}):"new-group"===b?(0,a.jsx)(eP,{users:_||[],onCreateGroup:e=>{(0,h.BH)((0,f.rJ)(N,"chats"),{...e,unreadCount:0}).then(e=>{e&&(P(e.id),C("chats"))})},onClose:()=>C("chats")}):"linked-devices"===b?(0,a.jsx)(eM,{onClose:()=>C("chats")}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("header",{className:"p-3 border-b border-border flex items-center justify-between bg-card",children:[(0,a.jsx)(T,{src:null!==(s=null==v?void 0:v.photoURL)&&void 0!==s?s:void 0,name:null!==(t=null==v?void 0:v.displayName)&&void 0!==t?t:void 0,className:"h-10 w-10"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(q,{id:"chats",icon:(0,a.jsx)(n.A,{}),tooltip:"Chats",badgeCount:J}),(0,a.jsx)(q,{id:"status",icon:(0,a.jsx)(i.A,{}),tooltip:"Status"}),(0,a.jsx)(q,{id:"calls",icon:(0,a.jsx)(d.A,{}),tooltip:"Calls"}),(0,a.jsxs)(ec,{children:[(0,a.jsx)(eo,{asChild:!0,children:(0,a.jsx)(w,{variant:"ghost",size:"icon",className:"rounded-full h-10 w-10 text-muted-foreground",children:(0,a.jsx)(c.A,{})})}),(0,a.jsxs)(eu,{align:"end",children:[(0,a.jsxs)(em,{onClick:()=>C("new-chat"),children:[(0,a.jsx)(o.A,{className:"mr-2 h-4 w-4"})," New Chat"]}),(0,a.jsxs)(em,{onClick:()=>C("new-group"),children:[(0,a.jsx)(u.A,{className:"mr-2 h-4 w-4"})," New Group"]}),(0,a.jsx)(ex,{}),(0,a.jsxs)(em,{onClick:()=>C("linked-devices"),children:[(0,a.jsx)(m.A,{className:"mr-2 h-4 w-4"})," Linked Devices"]}),(0,a.jsx)(em,{children:"Settings"}),(0,a.jsx)(ex,{}),(0,a.jsx)(em,{onClick:p,children:"Sign Out"})]})]})]})]}),(0,a.jsx)("div",{className:"p-3 border-b border-border",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),(0,a.jsx)(y,{placeholder:"chats"===b?"Search chats...":"status"===b?"Search statuses...":"Search calls...",className:"pl-10 bg-background"})]})}),"chats"===b&&(0,a.jsx)(G,{chats:U||[],selectedChat:E||null,onSelectChat:e=>{if(P(e.id),C("chats"),D(null),e.unreadCount>0){let s=(0,f.H9)(N,"chats",e.id);(0,f.mZ)(s,{unreadCount:0})}},isLoading:F}),"status"===b&&(0,a.jsx)(ej,{statuses:[],onViewStatus:e=>{}}),"calls"===b&&(0,a.jsx)(ew,{calls:j})]})}),(0,a.jsx)("div",{className:(0,g.cn)("flex-1 bg-secondary/50 transition-all duration-300",z&&"chats"===b?"flex":"hidden md:flex"),children:Z&&"chats"===b?(0,a.jsx)(ef,{chat:Z,onClose:()=>P(null),onSendMessage:e=>{if(!z||!v)return;let s=(0,f.rJ)(N,"chats",z,"messages");(0,h.BH)(s,{senderId:v.uid,text:e,timestamp:(0,f.O5)(),status:"sent"});let t=(0,f.H9)(N,"chats",z);(0,f.mZ)(t,{lastMessage:e,lastMessageTimestamp:(0,f.O5)(),unreadCount:((null==E?void 0:E.unreadCount)||0)+1})},allUsers:B}):(0,a.jsxs)("div",{className:"flex-col items-center justify-center h-full text-center hidden md:flex",children:[(0,a.jsx)(n.A,{className:"h-24 w-24 text-muted-foreground/50"}),(0,a.jsx)("h2",{className:"mt-4 text-2xl font-semibold text-muted-foreground",children:"SecureChat for Web"}),(0,a.jsx)("p",{className:"mt-2 text-muted-foreground",children:"Select a chat to start messaging or make a call."})]})})]})}var eU=t(4505),eF=t(7517);let eI=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,g.cn)("rounded-lg border bg-card text-card-foreground shadow-sm relative",t),...r})});eI.displayName="Card";let e_=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,g.cn)("flex flex-col space-y-1.5 p-6",t),...r})});e_.displayName="CardHeader";let eO=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("h3",{ref:s,className:(0,g.cn)("text-2xl font-semibold leading-none tracking-tight",t),...r})});eO.displayName="CardTitle";let eV=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("p",{ref:s,className:(0,g.cn)("text-sm text-muted-foreground",t),...r})});eV.displayName="CardDescription";let eE=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,g.cn)("p-6 pt-0",t),...r})});eE.displayName="CardContent",l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,g.cn)("flex items-center p-6 pt-0",t),...r})}).displayName="CardFooter";var eJ=t(4292),eG=t(1719),eH=t(1902);let eq=eJ.bL;eJ.YJ;let eB=eJ.WT,eZ=l.forwardRef((e,s)=>{let{className:t,children:r,...l}=e;return(0,a.jsxs)(eJ.l9,{ref:s,className:(0,g.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...l,children:[r,(0,a.jsx)(eJ.In,{asChild:!0,children:(0,a.jsx)(eG.A,{className:"h-4 w-4 opacity-50"})})]})});eZ.displayName=eJ.l9.displayName;let eW=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(eJ.PP,{ref:s,className:(0,g.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(eH.A,{className:"h-4 w-4"})})});eW.displayName=eJ.PP.displayName;let eK=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(eJ.wn,{ref:s,className:(0,g.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(eG.A,{className:"h-4 w-4"})})});eK.displayName=eJ.wn.displayName;let eX=l.forwardRef((e,s)=>{let{className:t,children:r,position:l="popper",...n}=e;return(0,a.jsx)(eJ.ZL,{children:(0,a.jsxs)(eJ.UC,{ref:s,className:(0,g.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:l,...n,children:[(0,a.jsx)(eW,{}),(0,a.jsx)(eJ.LM,{className:(0,g.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(eK,{})]})})});eX.displayName=eJ.UC.displayName,l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(eJ.JU,{ref:s,className:(0,g.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...r})}).displayName=eJ.JU.displayName;let eY=l.forwardRef((e,s)=>{let{className:t,children:r,...l}=e;return(0,a.jsxs)(eJ.q7,{ref:s,className:(0,g.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(eJ.VF,{children:(0,a.jsx)(E.A,{className:"h-4 w-4"})})}),(0,a.jsx)(eJ.p4,{children:r})]})});eY.displayName=eJ.q7.displayName,l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(eJ.wv,{ref:s,className:(0,g.cn)("-mx-1 my-1 h-px bg-muted",t),...r})}).displayName=eJ.wv.displayName;var eQ=t(2685);let e$=(0,N.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),e0=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(eQ.b,{ref:s,className:(0,g.cn)(e$(),t),...r})});e0.displayName=eQ.b.displayName;var e1=t(4565),e2=t(5564);function e4(){let e=(0,r.useAuth)(),s=(0,r.useFirestore)(),{toast:t}=(0,e2.dj)(),[n,i]=(0,l.useState)("phone"),[d,c]=(0,l.useState)(!1),[o,u]=(0,l.useState)(""),[m,x]=(0,l.useState)("+1"),[p,j]=(0,l.useState)(["","","","","",""]),[g,v]=(0,l.useState)(""),[N,b]=(0,l.useState)(null),C=(0,l.useRef)(null);(0,l.useEffect)(()=>{"phone"!==n||window.recaptchaVerifier||(window.recaptchaVerifier=new e1.kT(e,"recaptcha-container",{size:"invisible",callback:e=>{}}))},[e,n]);let A=async s=>{s.preventDefault(),c(!0);let a="".concat(m).concat(o),r=window.recaptchaVerifier;if(!r){t({variant:"destructive",title:"reCAPTCHA not initialized.",description:"Please refresh the page."}),c(!1);return}try{window.confirmationResult=await (0,e1.ik)(e,a,r),i("otp")}catch(e){console.error(e),t({variant:"destructive",title:"Failed to send OTP",description:e.message||"An unknown error occurred."}),window.recaptchaVerifier&&window.recaptchaVerifier.render().then(e=>{grecaptcha.reset(e)})}finally{c(!1)}},k=async e=>{e.preventDefault(),c(!0);let s=p.join("");if(!window.confirmationResult){t({variant:"destructive",title:"Verification failed.",description:"Please request a new OTP."}),i("phone"),c(!1);return}try{let e=await window.confirmationResult.confirm(s);e.user.metadata.creationTime===e.user.metadata.lastSignInTime&&i("profile")}catch(e){console.error(e),t({variant:"destructive",title:"Invalid OTP",description:"Please check the code and try again."})}finally{c(!1)}},S=async a=>{a.preventDefault(),c(!0);let r=e.currentUser;if(!r){t({variant:"destructive",title:"Authentication error",description:"No user is signed in."}),c(!1);return}if(""===g.trim()){t({variant:"destructive",title:"Profile Name is required"}),c(!1);return}try{await (0,e1.r7)(r,{displayName:g,photoURL:N});let e=(0,f.H9)(s,"users",r.uid);(0,h.wu)(e,{id:r.uid,username:g,phoneNumber:r.phoneNumber,profilePicture:N,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{})}catch(e){console.error("Error updating profile or saving to Firestore",e),t({variant:"destructive",title:"Profile update failed",description:e.message})}finally{c(!1)}},R=e=>{if(e.target.files&&e.target.files[0]){let s=new FileReader;s.onload=e=>{var s;b(null===(s=e.target)||void 0===s?void 0:s.result)},s.readAsDataURL(e.target.files[0])}},z=(e,s)=>{if(isNaN(Number(s)))return;let t=[...p];if(t[e]=s,j(t),s&&e<p.length-1){let s=document.getElementById("otp-".concat(e+1));null==s||s.focus()}},M=(e,s)=>{if("Backspace"===s.key&&!p[e]&&e>0){let s=document.getElementById("otp-".concat(e-1));null==s||s.focus()}};return(0,a.jsx)("div",{className:"flex items-center justify-center h-screen bg-background",children:(0,a.jsx)(eI,{className:"w-full max-w-sm",children:(()=>{switch(n){case"phone":return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(e_,{children:[(0,a.jsx)(eO,{children:"Welcome to SecureChat"}),(0,a.jsx)(eV,{children:"Enter your phone number to get started."})]}),(0,a.jsx)(eE,{children:(0,a.jsxs)("form",{onSubmit:A,children:[(0,a.jsx)("div",{className:"grid w-full items-center gap-4",children:(0,a.jsxs)("div",{className:"flex flex-col space-y-1.5",children:[(0,a.jsx)(e0,{htmlFor:"phone",children:"Phone Number"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(eq,{value:m,onValueChange:x,children:[(0,a.jsx)(eZ,{className:"w-[100px]",children:(0,a.jsx)(eB,{placeholder:"Country"})}),(0,a.jsxs)(eX,{children:[(0,a.jsx)(eY,{value:"+1",children:"US +1"}),(0,a.jsx)(eY,{value:"+91",children:"IN +91"}),(0,a.jsx)(eY,{value:"+44",children:"GB +44"})]})]}),(0,a.jsx)(y,{id:"phone",placeholder:"555-555-5555",type:"tel",value:o,onChange:e=>u(e.target.value),required:!0})]})]})}),(0,a.jsxs)(w,{type:"submit",className:"w-full mt-4",disabled:d,children:[d&&(0,a.jsx)(eU.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Send OTP"]}),(0,a.jsx)("div",{id:"recaptcha-container",className:"mt-2"})]})})]});case"otp":return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(e_,{children:[(0,a.jsx)(w,{variant:"ghost",size:"icon",className:"absolute top-3 left-3",onClick:()=>i("phone"),children:(0,a.jsx)(H.A,{})}),(0,a.jsx)(eO,{className:"text-center",children:"Enter OTP"}),(0,a.jsxs)(eV,{className:"text-center",children:["We've sent a 6-digit code to ",m,o,"."]})]}),(0,a.jsx)(eE,{children:(0,a.jsxs)("form",{onSubmit:k,children:[(0,a.jsx)("div",{className:"flex justify-center gap-2 mb-4",children:p.map((e,s)=>(0,a.jsx)(y,{id:"otp-".concat(s),type:"text",maxLength:1,value:e,onChange:e=>z(s,e.target.value),onKeyDown:e=>M(s,e),className:"w-12 h-12 text-center text-2xl",required:!0},s))}),(0,a.jsxs)(w,{type:"submit",className:"w-full mt-4",disabled:d,children:[d&&(0,a.jsx)(eU.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Verify"]}),(0,a.jsx)("div",{className:"text-center mt-4",children:(0,a.jsx)(w,{variant:"link",size:"sm",type:"button",onClick:e=>A(e),children:"Resend OTP"})})]})})]});case"profile":return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(e_,{children:[(0,a.jsx)(w,{variant:"ghost",size:"icon",className:"absolute top-3 left-3",onClick:()=>i("otp"),children:(0,a.jsx)(H.A,{})}),(0,a.jsx)(eO,{className:"text-center",children:"Set up your profile"}),(0,a.jsx)(eV,{className:"text-center",children:"Add your name and an optional profile picture."})]}),(0,a.jsx)(eE,{children:(0,a.jsxs)("form",{onSubmit:S,children:[(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(P,{className:"w-24 h-24 text-6xl",children:[(0,a.jsx)(L,{src:null!=N?N:void 0}),(0,a.jsx)(D,{children:(0,a.jsx)(eF.A,{})})]}),(0,a.jsx)(w,{type:"button",size:"icon",variant:"secondary",className:"absolute bottom-0 right-0 rounded-full",onClick:()=>{var e;return null===(e=C.current)||void 0===e?void 0:e.click()},children:(0,a.jsx)(ez.A,{className:"w-4 h-4"})}),(0,a.jsx)("input",{type:"file",ref:C,className:"hidden",accept:"image/*",onChange:R})]}),(0,a.jsxs)("div",{className:"w-full space-y-1.5",children:[(0,a.jsx)(e0,{htmlFor:"name",children:"Your Name"}),(0,a.jsx)(y,{id:"name",placeholder:"John Doe",value:g,onChange:e=>v(e.target.value),required:!0})]})]}),(0,a.jsxs)(w,{type:"submit",className:"w-full mt-6",disabled:d,children:[d&&(0,a.jsx)(eU.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Save and Continue"]})]})})]})}})()})})}function e5(){let{user:e,isUserLoading:s}=(0,r.useUser)(),t=(0,r.useAuth)();return s?(0,a.jsx)("div",{className:"flex h-screen w-full items-center justify-center",children:(0,a.jsx)(eU.A,{className:"h-12 w-12 animate-spin"})}):e?(0,a.jsx)(eT,{onSignOut:()=>{t.signOut()}}):(0,a.jsx)(e4,{})}}},e=>{var s=s=>e(e.s=s);e.O(0,[992,811,937,861,778,441,517,358],()=>s(2019)),_N_E=e.O()}]);