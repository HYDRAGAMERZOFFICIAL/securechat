(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2019:(e,s,t)=>{Promise.resolve().then(t.bind(t,5354))},5354:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>e2});var a=t(5155),r=t(6079),l=t(2115),n=t(9271),i=t(4947),d=t(3831),c=t(6293),o=t(9631),u=t(2823),m=t(1825),x=t(853),f=t(5534);let h=[],p=[];var g=t(1567),j=t(2317),v=t(1027);let N=(0,v.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),b=l.forwardRef((e,s)=>{let{className:t,variant:r,size:l,asChild:n=!1,...i}=e,d=n?j.DX:"button";return(0,a.jsx)(d,{className:(0,g.cn)(N({variant:r,size:l,className:t})),ref:s,...i})});b.displayName="Button";let y=l.forwardRef((e,s)=>{let{className:t,type:r,...l}=e;return(0,a.jsx)("input",{type:r,className:(0,g.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...l})});y.displayName="Input";var w=t(9710);let A=w.Kq,S=w.bL,C=w.l9,k=l.forwardRef((e,s)=>{let{className:t,sideOffset:r=4,...l}=e;return(0,a.jsx)(w.UC,{ref:s,sideOffset:r,className:(0,g.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...l})});k.displayName=w.UC.displayName;var T=t(1856);let R=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(T.bL,{ref:s,className:(0,g.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...r})});R.displayName=T.bL.displayName;let P=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(T._V,{ref:s,className:(0,g.cn)("aspect-square h-full w-full object-cover",t),...r})});P.displayName=T._V.displayName;let I=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(T.H4,{ref:s,className:(0,g.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...r})});I.displayName=T.H4.displayName;var z=t(1466);function O(e){let{src:s,name:t,className:r}=e;return(0,a.jsxs)(R,{className:(0,g.cn)("ring-2 ring-background",r),children:[(0,a.jsx)(P,{src:s,alt:t,className:"object-cover"}),(0,a.jsx)(I,{children:t?t.split(" ").map(e=>e[0]).join("").toUpperCase():(0,a.jsx)(z.A,{className:"h-5 w-5"})})]})}var D=t(1868);let _=l.forwardRef((e,s)=>{let{className:t,children:r,...l}=e;return(0,a.jsxs)(D.bL,{ref:s,className:(0,g.cn)("relative overflow-hidden",t),...l,children:[(0,a.jsx)(D.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,a.jsx)(M,{}),(0,a.jsx)(D.OK,{})]})});_.displayName=D.bL.displayName;let M=l.forwardRef((e,s)=>{let{className:t,orientation:r="vertical",...l}=e;return(0,a.jsx)(D.VM,{ref:s,orientation:r,className:(0,g.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...l,children:(0,a.jsx)(D.lr,{className:"relative flex-1 rounded-full bg-border"})})});M.displayName=D.VM.displayName;let E=(0,v.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function F(e){let{className:s,variant:t,...r}=e;return(0,a.jsx)("div",{className:(0,g.cn)(E({variant:t}),s),...r})}var L=t(4906),U=t(8867),V=t(76);function J(e){let{chats:s,selectedChat:t,onSelectChat:n,isLoading:i}=e,{user:d}=(0,r.A)(),[c,o]=(0,l.useState)([]);(0,l.useEffect)(()=>{(async()=>{try{let e=await f.F.users.getAll();o(e)}catch(e){console.error("Failed to fetch users",e)}})()},[]);let u=(0,l.useMemo)(()=>{let e=new Map;return null==c||c.forEach(s=>e.set(s.id,s)),e},[c]),m=e=>{if(!e||e.senderId!==(null==d?void 0:d.id))return null;let s="h-4 w-4 mr-1";return"read"===e.status?(0,a.jsx)(L.A,{className:(0,g.cn)(s,"text-primary")}):"delivered"===e.status?(0,a.jsx)(L.A,{className:s}):(0,a.jsx)(U.A,{className:s})},x=e=>{if(!e)return"";try{let s=new Date(e);if(!isNaN(s.getTime()))return(0,V.m)(s,{addSuffix:!0})}catch(e){}return"just now"},h=e=>e?e instanceof Date?e.getTime():new Date(e).getTime()||0:0;return i?(0,a.jsx)("div",{className:"p-4 space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"h-12 w-12 rounded-full bg-muted animate-pulse"}),(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)("div",{className:"h-4 w-3/4 rounded bg-muted animate-pulse"}),(0,a.jsx)("div",{className:"h-4 w-1/2 rounded bg-muted animate-pulse"})]})]},s))}):(0,a.jsx)(_,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-2",children:s.sort((e,s)=>h(s.lastMessageTimestamp)-h(e.lastMessageTimestamp)).map(e=>{var s;let r=null===(s=e.messages)||void 0===s?void 0:s[e.messages.length-1],l=e.name,i=e.avatar;if("private"===e.type){let s=e.members.find(e=>e!==(null==d?void 0:d.id)),t=s?u.get(s):void 0;t&&(l=t.username,i=t.profilePicture)}return(0,a.jsxs)("button",{onClick:()=>n(e),className:(0,g.cn)("flex items-center gap-3 w-full p-2 rounded-lg text-left transition-colors",(null==t?void 0:t.id)===e.id?"bg-accent text-accent-foreground":"hover:bg-muted"),children:[(0,a.jsx)(O,{src:i,name:l,className:"h-12 w-12"}),(0,a.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-semibold truncate",children:l}),e.lastMessageTimestamp&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground flex-shrink-0",children:x(e.lastMessageTimestamp)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,a.jsxs)("p",{className:"text-sm text-muted-foreground truncate flex items-center",children:[m(r),e.lastMessage||"No messages yet"]}),e.unreadCount>0&&(0,a.jsx)(F,{variant:"default",className:"flex-shrink-0",children:e.unreadCount})]})]})]},e.id)})})})}var G=t(7364),q=t(7820),B=t(8291),H=t(3963),Z=t(3817),W=t(5843),X=t(5015),K=t(2316),Y=t(4081),Q=t(8283),$=t(7280);function ee(e){let{message:s,sender:t}=e,{user:l}=(0,r.A)(),n=s.senderId===(null==l?void 0:l.id);return(0,a.jsxs)("div",{className:(0,g.cn)("flex items-end gap-2 max-w-[75%]",n?"ml-auto flex-row-reverse":"mr-auto"),children:[!n&&(0,a.jsx)(O,{src:null==t?void 0:t.avatar,name:null==t?void 0:t.name,className:"h-8 w-8"}),(0,a.jsxs)("div",{className:(0,g.cn)("rounded-xl px-4 py-2",n?"bg-primary text-primary-foreground rounded-br-none":"bg-card text-card-foreground rounded-bl-none border"),children:[!n&&t&&(0,a.jsx)("p",{className:"text-xs font-semibold text-primary mb-1",children:t.name}),(0,a.jsx)("p",{className:"text-base whitespace-pre-wrap break-words",children:s.text}),(0,a.jsxs)("div",{className:"flex items-center justify-end mt-1",children:[(0,a.jsx)("span",{className:"text-xs text-muted-foreground/80",children:(e=>{if(!e)return"";try{let s=e instanceof Date?e:new Date(e);return(0,$.GP)(s,"HH:mm")}catch(e){return""}})(s.timestamp)}),(()=>{if(!n)return null;let e="h-4 w-4 ml-1.5 flex-shrink-0";return"read"===s.status?(0,a.jsx)(L.A,{className:(0,g.cn)(e,"text-blue-500")}):"delivered"===s.status?(0,a.jsx)(L.A,{className:(0,g.cn)(e,"text-muted-foreground")}):(0,a.jsx)(U.A,{className:(0,g.cn)(e,"text-muted-foreground")})})()]})]})]})}let es=(0,v.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),et=l.forwardRef((e,s)=>{let{className:t,variant:r,...l}=e;return(0,a.jsx)("div",{ref:s,role:"alert",className:(0,g.cn)(es({variant:r}),t),...l})});et.displayName="Alert";let ea=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("h5",{ref:s,className:(0,g.cn)("mb-1 font-medium leading-none tracking-tight",t),...r})});ea.displayName="AlertTitle";let er=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,g.cn)("text-sm [&_p]:leading-relaxed",t),...r})});er.displayName="AlertDescription";var el=t(4471),en=t(6967),ei=t(3565);let ed=el.bL,ec=el.l9;el.YJ,el.ZL,el.Pb,el.z6,l.forwardRef((e,s)=>{let{className:t,inset:r,children:l,...n}=e;return(0,a.jsxs)(el.ZP,{ref:s,className:(0,g.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",t),...n,children:[l,(0,a.jsx)(en.A,{className:"ml-auto"})]})}).displayName=el.ZP.displayName,l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(el.G5,{ref:s,className:(0,g.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})}).displayName=el.G5.displayName;let eo=l.forwardRef((e,s)=>{let{className:t,sideOffset:r=4,...l}=e;return(0,a.jsx)(el.ZL,{children:(0,a.jsx)(el.UC,{ref:s,sideOffset:r,className:(0,g.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...l})})});eo.displayName=el.UC.displayName;let eu=l.forwardRef((e,s)=>{let{className:t,inset:r,...l}=e;return(0,a.jsx)(el.q7,{ref:s,className:(0,g.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",t),...l})});eu.displayName=el.q7.displayName,l.forwardRef((e,s)=>{let{className:t,children:r,checked:l,...n}=e;return(0,a.jsxs)(el.H_,{ref:s,className:(0,g.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:l,...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(el.VF,{children:(0,a.jsx)(U.A,{className:"h-4 w-4"})})}),r]})}).displayName=el.H_.displayName,l.forwardRef((e,s)=>{let{className:t,children:r,...l}=e;return(0,a.jsxs)(el.hN,{ref:s,className:(0,g.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(el.VF,{children:(0,a.jsx)(ei.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=el.hN.displayName,l.forwardRef((e,s)=>{let{className:t,inset:r,...l}=e;return(0,a.jsx)(el.JU,{ref:s,className:(0,g.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",t),...l})}).displayName=el.JU.displayName;let em=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(el.wv,{ref:s,className:(0,g.cn)("-mx-1 my-1 h-px bg-muted",t),...r})});function ex(e){var s,t,n;let{chat:i,onClose:o,onSendMessage:u,allUsers:m}=e,[x,h]=(0,l.useState)(""),{user:p}=(0,r.A)(),[g,j]=(0,l.useState)([]),[v,N]=(0,l.useState)(!0);(0,l.useEffect)(()=>{if(i){w();let e=setInterval(w,3e3);return()=>clearInterval(e)}},[i]);let w=async()=>{try{let e=await f.F.messages.getByChatId(i.id);j(e)}catch(e){console.error("Failed to fetch messages",e)}finally{N(!1)}},A=(0,l.useMemo)(()=>{let e=new Map;return i.members&&i.members.forEach(s=>{let t=m.get(s);t&&e.set(s,{name:t.username,avatar:t.profilePicture})}),e},[i.members,m]),S=e=>{if(!e)return"";try{let s=new Date(e);if(!isNaN(s.getTime()))return(0,$.GP)(s,"p")}catch(e){}return String(e)},C="private"===i.type?null===(s=m.get(i.members.find(e=>e!==(null==p?void 0:p.id))))||void 0===s?void 0:s.username:i.name,k="private"===i.type?null===(t=m.get(i.members.find(e=>e!==(null==p?void 0:p.id))))||void 0===t?void 0:t.profilePicture:i.avatar;return(0,a.jsxs)("div",{className:"flex flex-col h-full bg-card w-full",children:[(0,a.jsxs)("header",{className:"flex items-center p-3 border-b border-border",children:[(0,a.jsx)(b,{variant:"ghost",size:"icon",className:"mr-2 md:hidden",onClick:o,children:(0,a.jsx)(G.A,{})}),(0,a.jsx)(O,{src:k,name:C,className:"h-10 w-10"}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h2",{className:"font-semibold text-lg",children:C}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"group"===i.type?"".concat(null===(n=i.members)||void 0===n?void 0:n.length," members"):"online"})]}),(0,a.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,a.jsx)(b,{variant:"ghost",size:"icon",className:"rounded-full h-10 w-10",children:(0,a.jsx)(q.A,{})}),(0,a.jsx)(b,{variant:"ghost",size:"icon",className:"rounded-full h-10 w-10",children:(0,a.jsx)(d.A,{})}),(0,a.jsxs)(ed,{children:[(0,a.jsx)(ec,{asChild:!0,children:(0,a.jsx)(b,{variant:"ghost",size:"icon",className:"rounded-full h-10 w-10",children:(0,a.jsx)(c.A,{})})}),(0,a.jsxs)(eo,{align:"end",children:[(0,a.jsx)(eu,{children:"View Contact"}),(0,a.jsx)(eu,{children:"Search"}),(0,a.jsx)(em,{}),(0,a.jsxs)(eu,{className:"text-destructive",children:[(0,a.jsx)(B.A,{className:"mr-2 h-4 w-4"}),"Block"]}),(0,a.jsxs)(eu,{className:"text-destructive",children:[(0,a.jsx)(H.A,{className:"mr-2 h-4 w-4"}),"Report"]})]})]})]})]}),(0,a.jsx)(_,{className:"flex-1 bg-secondary/30",children:(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsxs)(et,{className:"bg-accent/20 border-accent/30",children:[(0,a.jsx)(Z.A,{className:"h-4 w-4 text-accent"}),(0,a.jsx)(ea,{className:"text-sm font-semibold text-accent",children:"End-to-end Encrypted"}),(0,a.jsx)(er,{className:"text-xs text-accent/80",children:"Messages and calls are secured. No one outside of this chat, not even SecureChat, can read or listen to them."})]}),v&&(0,a.jsx)("p",{children:"Loading messages..."}),null==g?void 0:g.map(e=>(0,a.jsx)(ee,{message:{...e,timestamp:S(e.timestamp)},sender:A.get(e.senderId)},e.id))]})}),(0,a.jsx)("footer",{className:"p-3 border-t border-border",children:(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),""!==x.trim()&&(u(x),h(""))},className:"flex items-center gap-2",children:[(0,a.jsx)(b,{type:"button",variant:"ghost",size:"icon",className:"rounded-full h-10 w-10",children:(0,a.jsx)(W.A,{})}),(0,a.jsxs)(ed,{children:[(0,a.jsx)(ec,{asChild:!0,children:(0,a.jsx)(b,{type:"button",variant:"ghost",size:"icon",className:"rounded-full h-10 w-10",children:(0,a.jsx)(X.A,{})})}),(0,a.jsxs)(eo,{children:[(0,a.jsxs)(eu,{children:[(0,a.jsx)(K.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Photo or Video"})]}),(0,a.jsxs)(eu,{children:[(0,a.jsx)(Y.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Document"})]})]})]}),(0,a.jsx)(y,{placeholder:"Type a message...",className:"flex-1 rounded-full px-4",value:x,onChange:e=>h(e.target.value)}),(0,a.jsx)(b,{type:"submit",size:"icon",className:"rounded-full h-10 w-10 bg-primary hover:bg-primary/90",children:(0,a.jsx)(Q.A,{})})]})})]})}em.displayName=el.wv.displayName;var ef=t(3473);let eh=h.find(e=>"user-2"===e.id);function ep(e){let{statuses:s,onViewStatus:t}=e,r=s.reduce((e,s)=>(e[s.userId]||(e[s.userId]=[]),e[s.userId].push(s),e),{}),l=Object.values(r).map(e=>e[e.length-1]).filter(e=>e.userId!==(null==eh?void 0:eh.id)).sort((e,s)=>new Date(s.timestamp).getTime()-new Date(e.timestamp).getTime());return(0,a.jsx)(_,{className:"flex-1",children:(0,a.jsxs)("div",{className:"p-2 space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg cursor-pointer hover:bg-muted",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(O,{src:null==eh?void 0:eh.avatar,name:null==eh?void 0:eh.name,className:"h-12 w-12"}),(0,a.jsx)("div",{className:"absolute bottom-0 right-0 bg-primary text-primary-foreground rounded-full h-5 w-5 flex items-center justify-center border-2 border-background",children:(0,a.jsx)(ef.A,{className:"h-3 w-3"})})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold",children:"My status"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Add to my status"})]})]}),(0,a.jsx)("h4",{className:"px-3 pt-4 pb-2 text-sm font-semibold text-muted-foreground",children:"Recent updates"}),l.map(e=>{let s=h.find(s=>s.id===e.userId);if(!s)return null;let l=r[s.id].some(e=>!e.viewed);return(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg cursor-pointer hover:bg-muted",onClick:()=>t(s.id),children:[(0,a.jsx)("div",{className:(0,g.cn)("p-0.5 rounded-full",l?"bg-gradient-to-tr from-yellow-400 to-pink-500":"bg-muted"),children:(0,a.jsx)("div",{className:"p-0.5 bg-background rounded-full",children:(0,a.jsx)(O,{src:s.avatar,name:s.name,className:"h-12 w-12"})})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold",children:s.name}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},e.id)})]})})}var eg=t(770),ej=t(2048),ev=t(3723);let eN=e=>{let s=e.find(e=>"user-2"!==e);return h.find(e=>e.id===s)};function eb(e){let{calls:s}=e;return(0,a.jsx)(_,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-2 space-y-1",children:s.map(e=>{let s=eN(e.participantIds);if(!s)return null;let t="missed"===e.status,r="video"===e.type?q.A:"incoming"===e.direction?eg.A:ej.A;return(0,a.jsxs)("div",{className:(0,g.cn)("flex items-center gap-3 p-2 rounded-lg cursor-pointer hover:bg-muted"),children:[(0,a.jsx)(O,{src:s.avatar,name:s.name,className:"h-12 w-12"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:(0,g.cn)("font-semibold",t&&"text-destructive"),children:s.name}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:["missed"===e.status?(0,a.jsx)(ev.A,{className:(0,g.cn)("h-4 w-4",t&&"text-destructive")}):(0,a.jsx)(r,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"outgoing"===e.direction?"Outgoing":"Incoming"})]})]}),(0,a.jsxs)("div",{className:"text-right",children:["video"===e.type?(0,a.jsx)(q.A,{className:"h-5 w-5 text-primary"}):(0,a.jsx)(d.A,{className:"h-5 w-5 text-primary"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:e.timestamp})]})]},e.id)})})})}var ey=t(3518),ew=t(767),eA=t(3057);let eS=l.forwardRef((e,s)=>{let{className:t,value:r,...l}=e;return(0,a.jsx)(eA.bL,{ref:s,className:(0,g.cn)("relative h-1 w-full overflow-hidden rounded-full bg-white/20",t),...l,children:(0,a.jsx)(eA.C1,{className:"h-full w-full flex-1 bg-white transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});function eC(e){var s;let{statuses:t,onClose:r}=e,[n,i]=(0,l.useState)(0),[d,c]=(0,l.useState)(0),[o,u]=(0,l.useState)(0),m=(0,l.useRef)(null),x=(0,l.useRef)(null),f=h.filter(e=>t.some(s=>s.userId===e.id)),p=null===(s=f[n])||void 0===s?void 0:s.id,g=t.filter(e=>e.userId===p),j=g[d],v=h.find(e=>e.id===(null==j?void 0:j.userId)),N=()=>{m.current&&clearTimeout(m.current),x.current&&clearInterval(x.current),u(0)},b=()=>{N(),d<g.length-1?c(d+1):n<f.length-1?(i(n+1),c(0)):r()};(0,l.useEffect)(()=>{if(!j)return;let e=1e3*j.duration;m.current=setTimeout(b,e);let s=Date.now();return x.current=setInterval(()=>{let t=(Date.now()-s)/e*100;t<=100?u(t):x.current&&clearInterval(x.current)},50),()=>{N()}},[j,n,d]);let y=e=>{e.stopPropagation(),N(),d>0?c(d-1):n>0&&(i(n-1),c(t.filter(e=>e.userId===f[n-1].id).length-1))},w=e=>{e.stopPropagation(),b()};return v&&j?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center z-50",onClick:r,children:(0,a.jsxs)("div",{className:"relative w-full h-full max-w-lg max-h-screen flex flex-col items-center justify-center",children:[(0,a.jsx)("button",{onClick:y,className:"absolute left-2 top-1/2 -translate-y-1/2 z-20 text-white p-2 bg-black/20 rounded-full",children:(0,a.jsx)(ey.A,{size:24})}),(0,a.jsx)("button",{onClick:w,className:"absolute right-2 top-1/2 -translate-y-1/2 z-20 text-white p-2 bg-black/20 rounded-full",children:(0,a.jsx)(en.A,{size:24})}),(0,a.jsxs)("div",{className:"absolute top-0 left-0 right-0 p-4 z-20",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-2",children:g.map((e,s)=>(0,a.jsx)(eS,{value:s<d?100:s===d?o:0,className:"h-1 flex-1"},s))}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(O,{src:v.avatar,name:v.name,className:"h-10 w-10"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-white",children:v.name}),(0,a.jsx)("p",{className:"text-xs text-neutral-300",children:new Date(j.timestamp).toLocaleTimeString()})]})]}),(0,a.jsx)("button",{onClick:r,className:"text-white",children:(0,a.jsx)(ew.A,{size:24})})]})]}),(0,a.jsx)("img",{src:j.imageUrl,alt:"Status from ".concat(v.name),className:"object-contain max-w-full max-h-full rounded-lg",onClick:e=>{let s=e.currentTarget.getBoundingClientRect();e.clientX-s.left<s.width/3?y(e):w(e)}})]})}):null}function ek(e){let{users:s,onSelectUser:t,onClose:n}=e,{user:i}=(0,r.A)(),[d,c]=(0,l.useState)(""),o=s.filter(e=>e.id!==(null==i?void 0:i.id)).filter(e=>{var s;return null===(s=e.username)||void 0===s?void 0:s.toLowerCase().includes(d.toLowerCase())});return(0,a.jsxs)("div",{className:"flex flex-col h-full bg-card",children:[(0,a.jsxs)("header",{className:"p-3 border-b border-border flex items-center",children:[(0,a.jsx)(b,{variant:"ghost",size:"icon",className:"mr-2",onClick:n,children:(0,a.jsx)(G.A,{})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"New Chat"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Select a contact to start a chat"})]})]}),(0,a.jsx)("div",{className:"p-3 border-b border-border",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),(0,a.jsx)(y,{placeholder:"Search contacts...",className:"pl-10 bg-background",value:d,onChange:e=>c(e.target.value)})]})}),(0,a.jsx)(_,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-2",children:o.map(e=>(0,a.jsxs)("div",{onClick:()=>t(e),className:"flex items-center gap-3 w-full p-2 rounded-lg text-left transition-colors hover:bg-muted cursor-pointer",children:[(0,a.jsx)(O,{src:e.profilePicture,name:e.username,className:"h-12 w-12"}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,a.jsx)("h3",{className:"font-semibold truncate",children:e.username})})]},e.id))})})]})}eS.displayName=eA.bL.displayName;var eT=t(1190);function eR(e){let{users:s,onCreateGroup:t,onClose:n}=e,{user:i}=(0,r.A)(),[d,c]=(0,l.useState)(""),[o,m]=(0,l.useState)(null),[f,h]=(0,l.useState)([]),p=(0,l.useRef)(null),[g,j]=(0,l.useState)(""),v=e=>{h(s=>s.find(s=>s.id===e.id)?s.filter(s=>s.id!==e.id):[...s,e])},N=s.filter(e=>e.id!==(null==i?void 0:i.id)).filter(e=>{var s;return null===(s=e.username)||void 0===s?void 0:s.toLowerCase().includes(g.toLowerCase())});return(0,a.jsxs)("div",{className:"flex flex-col h-full bg-card",children:[(0,a.jsxs)("header",{className:"p-3 border-b border-border flex items-center",children:[(0,a.jsx)(b,{variant:"ghost",size:"icon",className:"mr-2",onClick:n,children:(0,a.jsx)(G.A,{})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"New Group"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Add subject and select members"})]})]}),(0,a.jsx)("div",{className:"p-4 space-y-4 border-b",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(R,{className:"w-16 h-16 text-3xl",children:[(0,a.jsx)(P,{src:null!=o?o:void 0}),(0,a.jsx)(I,{children:(0,a.jsx)(u.A,{})})]}),(0,a.jsx)(b,{type:"button",size:"icon",variant:"secondary",className:"absolute bottom-0 right-0 rounded-full h-6 w-6",onClick:()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.click()},children:(0,a.jsx)(eT.A,{className:"w-3 h-3"})}),(0,a.jsx)("input",{type:"file",ref:p,className:"hidden",accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files[0]){let s=new FileReader;s.onload=e=>{var s;m(null===(s=e.target)||void 0===s?void 0:s.result)},s.readAsDataURL(e.target.files[0])}}})]}),(0,a.jsx)(y,{placeholder:"Group Subject",value:d,onChange:e=>c(e.target.value),className:"text-lg"})]})}),(0,a.jsx)("div",{className:"p-3 border-b border-border",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),(0,a.jsx)(y,{placeholder:"Search contacts...",className:"pl-10 bg-background",value:g,onChange:e=>j(e.target.value)})]})}),(0,a.jsx)(_,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-2",children:N.map(e=>(0,a.jsxs)("div",{onClick:()=>v(e),className:"flex items-center gap-3 w-full p-2 rounded-lg text-left transition-colors hover:bg-muted cursor-pointer",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(O,{src:e.profilePicture,name:e.username,className:"h-12 w-12"}),f.find(s=>s.id===e.id)&&(0,a.jsx)("div",{className:"absolute bottom-0 right-0 bg-primary rounded-full p-0.5",children:(0,a.jsx)(U.A,{className:"h-3 w-3 text-primary-foreground"})})]}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,a.jsx)("h3",{className:"font-semibold truncate",children:e.username})})]},e.id))})}),f.length>0&&(0,a.jsx)("footer",{className:"p-4 bg-card border-t",children:(0,a.jsxs)(b,{className:"w-full",onClick:()=>{d.trim()&&f.length>0&&i&&t({type:"group",name:d,avatar:o||"https://ui-avatars.com/api/?name=".concat(encodeURIComponent(d),"&background=random"),members:[i.id,...f.map(e=>e.id)],lastMessage:"Group created",lastMessageTimestamp:new Date().toISOString()})},disabled:!d.trim(),children:["Create Group (",f.length," selected)"]})})]})}var eP=t(7568),eI=t(6954);function ez(e){let{onClose:s}=e;return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("header",{className:"p-3 border-b border-border flex items-center bg-card",children:[(0,a.jsx)(b,{variant:"ghost",size:"icon",className:"mr-2",onClick:s,children:(0,a.jsx)(G.A,{})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Linked Devices"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Manage your connected devices"})]})]}),(0,a.jsxs)("div",{className:"p-6 text-center border-b",children:[(0,a.jsx)("div",{className:"flex justify-center mb-4",children:(0,a.jsx)(eP.A,{className:"h-24 w-24 text-muted-foreground"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Link a new device"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Scan this code with your phone to log in instantly."}),(0,a.jsx)(b,{children:"Link a Device"})]}),(0,a.jsx)(_,{className:"flex-1",children:(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-muted-foreground px-2",children:"Device List"}),[{type:"desktop",name:"MacOS",location:"San Francisco, US",lastActive:"now",isCurrent:!0},{type:"mobile",name:"Pixel 8 Pro",location:"San Francisco, US",lastActive:"2 hours ago",isCurrent:!1}].map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center gap-4 p-2 rounded-lg hover:bg-muted",children:["desktop"===e.type?(0,a.jsx)(m.A,{className:"h-8 w-8 text-muted-foreground"}):(0,a.jsx)(eI.A,{className:"h-8 w-8 text-muted-foreground"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.location," â€¢ ",e.isCurrent?(0,a.jsx)("span",{className:"text-green-500",children:"Active now"}):"Last active ".concat(e.lastActive)]})]}),!e.isCurrent&&(0,a.jsxs)(ed,{children:[(0,a.jsx)(ec,{asChild:!0,children:(0,a.jsx)(b,{variant:"ghost",size:"icon",children:(0,a.jsx)(c.A,{className:"h-4 w-4"})})}),(0,a.jsx)(eo,{align:"end",children:(0,a.jsx)(eu,{className:"text-destructive",children:"Log out"})})]})]},s))]})})]})}function eO(e){var s,t;let{onSignOut:h}=e,{user:j}=(0,r.A)(),[v,N]=(0,l.useState)("chats"),[w,T]=(0,l.useState)(null),[R,P]=(0,l.useState)(null),[I,z]=(0,l.useState)([]),[D,_]=(0,l.useState)([]),[M,E]=(0,l.useState)(!0),[L,U]=(0,l.useState)(!0);(0,l.useEffect)(()=>{if(j){V(),G();let e=setInterval(()=>{V()},5e3);return()=>clearInterval(e)}},[j]);let V=async()=>{if(j)try{let e=await f.F.chats.getAll(j.id);z(e)}catch(e){console.error("Failed to fetch chats",e)}finally{E(!1)}},G=async()=>{try{let e=await f.F.users.getAll();_(e)}catch(e){console.error("Failed to fetch users",e)}finally{U(!1)}},q=null==I?void 0:I.find(e=>e.id===w),B=(0,l.useMemo)(()=>I?I.reduce((e,s)=>e+(s.unreadCount||0),0):0,[I]),H=async e=>{if(!j)return;let s=I.find(s=>"private"===s.type&&s.members.includes(e.id));if(s)T(s.id);else{let s=Math.random().toString(36).substring(7),t={id:s,type:"private",name:e.username,avatar:e.profilePicture,members:[e.id,j.id]};await f.F.chats.create(t),await V(),T(s)}N("chats")},Z=async e=>{let s=Math.random().toString(36).substring(7);await f.F.chats.create({...e,id:s}),await V(),T(s),N("chats")},W=async e=>{if(!w||!j)return;let s={id:Math.random().toString(36).substring(7),chat_id:w,sender_id:j.id,text:e,status:"sent"};await f.F.messages.send(s),V()},X=e=>{let{id:s,icon:t,tooltip:r,badgeCount:l}=e;return(0,a.jsx)(A,{children:(0,a.jsxs)(S,{children:[(0,a.jsx)(C,{asChild:!0,children:(0,a.jsxs)(b,{variant:"ghost",size:"icon",className:(0,g.cn)("rounded-full h-10 w-10 relative",v===s?"bg-accent text-accent-foreground":"text-muted-foreground"),onClick:()=>{N(s),T(null)},children:[t,l&&l>0&&(0,a.jsx)(F,{className:"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0",children:l})]})}),(0,a.jsx)(k,{side:"right",children:(0,a.jsx)("p",{children:r})})]})})},K=(0,l.useMemo)(()=>{let e=new Map;return D&&D.forEach(s=>e.set(s.id,s)),j&&!e.has(j.id)&&e.set(j.id,{id:j.id,username:j.username,profilePicture:j.profilePicture,name:j.username,avatar:j.profilePicture,online:!0}),e},[D,j]),Y=(0,l.useMemo)(()=>{if(!q)return null;let e=q.members.filter(e=>e!==(null==j?void 0:j.id)),s=q.name,t=q.avatar;if("private"===q.type&&e.length>0){let a=K.get(e[0]);a&&(s=a.username,t=a.profilePicture)}return{...q,name:s,avatar:t}},[q,K,j]);return R?(0,a.jsx)(eC,{statuses:R,onClose:()=>{P(null)}}):(0,a.jsxs)("div",{className:"flex w-full h-screen",children:[(0,a.jsx)("div",{className:(0,g.cn)("flex flex-col border-r border-border transition-all duration-300 bg-card",w&&"chats"===v?"w-full md:w-[30%] md:max-w-sm":"w-full",!(w&&"chats"===v)&&"md:w-full",w&&"chats"===v&&"hidden md:flex"),children:"new-chat"===v?(0,a.jsx)(ek,{users:D||[],onSelectUser:H,onClose:()=>N("chats")}):"new-group"===v?(0,a.jsx)(eR,{users:D||[],onCreateGroup:Z,onClose:()=>N("chats")}):"linked-devices"===v?(0,a.jsx)(ez,{onClose:()=>N("chats")}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("header",{className:"p-3 border-b border-border flex items-center justify-between bg-card",children:[(0,a.jsx)(O,{src:null!==(s=null==j?void 0:j.profilePicture)&&void 0!==s?s:void 0,name:null!==(t=null==j?void 0:j.username)&&void 0!==t?t:void 0,className:"h-10 w-10"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(X,{id:"chats",icon:(0,a.jsx)(n.A,{}),tooltip:"Chats",badgeCount:B}),(0,a.jsx)(X,{id:"status",icon:(0,a.jsx)(i.A,{}),tooltip:"Status"}),(0,a.jsx)(X,{id:"calls",icon:(0,a.jsx)(d.A,{}),tooltip:"Calls"}),(0,a.jsxs)(ed,{children:[(0,a.jsx)(ec,{asChild:!0,children:(0,a.jsx)(b,{variant:"ghost",size:"icon",className:"rounded-full h-10 w-10 text-muted-foreground",children:(0,a.jsx)(c.A,{})})}),(0,a.jsxs)(eo,{align:"end",children:[(0,a.jsxs)(eu,{onClick:()=>N("new-chat"),children:[(0,a.jsx)(o.A,{className:"mr-2 h-4 w-4"})," New Chat"]}),(0,a.jsxs)(eu,{onClick:()=>N("new-group"),children:[(0,a.jsx)(u.A,{className:"mr-2 h-4 w-4"})," New Group"]}),(0,a.jsx)(em,{}),(0,a.jsxs)(eu,{onClick:()=>N("linked-devices"),children:[(0,a.jsx)(m.A,{className:"mr-2 h-4 w-4"})," Linked Devices"]}),(0,a.jsx)(eu,{children:"Settings"}),(0,a.jsx)(em,{}),(0,a.jsx)(eu,{onClick:h,children:"Sign Out"})]})]})]})]}),(0,a.jsx)("div",{className:"p-3 border-b border-border",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),(0,a.jsx)(y,{placeholder:"chats"===v?"Search chats...":"status"===v?"Search statuses...":"Search calls...",className:"pl-10 bg-background"})]})}),"chats"===v&&(0,a.jsx)(J,{chats:I||[],selectedChat:q||null,onSelectChat:e=>{T(e.id),N("chats"),P(null)},isLoading:M}),"status"===v&&(0,a.jsx)(ep,{statuses:[],onViewStatus:e=>{}}),"calls"===v&&(0,a.jsx)(eb,{calls:p})]})}),(0,a.jsx)("div",{className:(0,g.cn)("flex-1 bg-secondary/50 transition-all duration-300",w&&"chats"===v?"flex":"hidden md:flex"),children:Y&&"chats"===v?(0,a.jsx)(ex,{chat:Y,onClose:()=>T(null),onSendMessage:W,allUsers:K}):(0,a.jsxs)("div",{className:"flex-col items-center justify-center h-full text-center hidden md:flex",children:[(0,a.jsx)(n.A,{className:"h-24 w-24 text-muted-foreground/50"}),(0,a.jsx)("h2",{className:"mt-4 text-2xl font-semibold text-muted-foreground",children:"SecureChat for Web"}),(0,a.jsx)("p",{className:"mt-2 text-muted-foreground",children:"Select a chat to start messaging or make a call."})]})})]})}var eD=t(4505),e_=t(7517);let eM=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,g.cn)("rounded-lg border bg-card text-card-foreground shadow-sm relative",t),...r})});eM.displayName="Card";let eE=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,g.cn)("flex flex-col space-y-1.5 p-6",t),...r})});eE.displayName="CardHeader";let eF=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("h3",{ref:s,className:(0,g.cn)("text-2xl font-semibold leading-none tracking-tight",t),...r})});eF.displayName="CardTitle";let eL=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("p",{ref:s,className:(0,g.cn)("text-sm text-muted-foreground",t),...r})});eL.displayName="CardDescription";let eU=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,g.cn)("p-6 pt-0",t),...r})});eU.displayName="CardContent",l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,g.cn)("flex items-center p-6 pt-0",t),...r})}).displayName="CardFooter";var eV=t(4292),eJ=t(1719),eG=t(1902);let eq=eV.bL;eV.YJ;let eB=eV.WT,eH=l.forwardRef((e,s)=>{let{className:t,children:r,...l}=e;return(0,a.jsxs)(eV.l9,{ref:s,className:(0,g.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...l,children:[r,(0,a.jsx)(eV.In,{asChild:!0,children:(0,a.jsx)(eJ.A,{className:"h-4 w-4 opacity-50"})})]})});eH.displayName=eV.l9.displayName;let eZ=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(eV.PP,{ref:s,className:(0,g.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(eG.A,{className:"h-4 w-4"})})});eZ.displayName=eV.PP.displayName;let eW=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(eV.wn,{ref:s,className:(0,g.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(eJ.A,{className:"h-4 w-4"})})});eW.displayName=eV.wn.displayName;let eX=l.forwardRef((e,s)=>{let{className:t,children:r,position:l="popper",...n}=e;return(0,a.jsx)(eV.ZL,{children:(0,a.jsxs)(eV.UC,{ref:s,className:(0,g.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:l,...n,children:[(0,a.jsx)(eZ,{}),(0,a.jsx)(eV.LM,{className:(0,g.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(eW,{})]})})});eX.displayName=eV.UC.displayName,l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(eV.JU,{ref:s,className:(0,g.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...r})}).displayName=eV.JU.displayName;let eK=l.forwardRef((e,s)=>{let{className:t,children:r,...l}=e;return(0,a.jsxs)(eV.q7,{ref:s,className:(0,g.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(eV.VF,{children:(0,a.jsx)(U.A,{className:"h-4 w-4"})})}),(0,a.jsx)(eV.p4,{children:r})]})});eK.displayName=eV.q7.displayName,l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(eV.wv,{ref:s,className:(0,g.cn)("-mx-1 my-1 h-px bg-muted",t),...r})}).displayName=eV.wv.displayName;var eY=t(2685);let eQ=(0,v.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),e$=l.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(eY.b,{ref:s,className:(0,g.cn)(eQ(),t),...r})});e$.displayName=eY.b.displayName;var e0=t(5564);function e1(){let{login:e,register:s}=(0,r.A)(),{toast:t}=(0,e0.dj)(),[n,i]=(0,l.useState)("phone"),[d,c]=(0,l.useState)(!1),[o,u]=(0,l.useState)(""),[m,x]=(0,l.useState)("+1"),[f,h]=(0,l.useState)(["","","","","",""]),[p,g]=(0,l.useState)(""),[j,v]=(0,l.useState)(null),N=(0,l.useRef)(null),w=async s=>{s.preventDefault(),c(!0);let a="".concat(m).concat(o);try{try{await e(a)}catch(e){i("otp")}}catch(e){console.error(e),t({variant:"destructive",title:"Error",description:e.message||"An unknown error occurred."})}finally{c(!1)}},A=async e=>{e.preventDefault(),c(!0),setTimeout(()=>{i("profile"),c(!1)},1e3)},S=async e=>{e.preventDefault(),c(!0);let a="".concat(m).concat(o);if(""===p.trim()){t({variant:"destructive",title:"Profile Name is required"}),c(!1);return}try{await s(a,p,j),t({title:"Success",description:"Profile created successfully."})}catch(e){console.error("Error creating profile",e),t({variant:"destructive",title:"Profile creation failed",description:e.message})}finally{c(!1)}},C=e=>{if(e.target.files&&e.target.files[0]){let s=new FileReader;s.onload=e=>{var s;v(null===(s=e.target)||void 0===s?void 0:s.result)},s.readAsDataURL(e.target.files[0])}},k=(e,s)=>{if(isNaN(Number(s)))return;let t=[...f];if(t[e]=s,h(t),s&&e<f.length-1){let s=document.getElementById("otp-".concat(e+1));null==s||s.focus()}},T=(e,s)=>{if("Backspace"===s.key&&!f[e]&&e>0){let s=document.getElementById("otp-".concat(e-1));null==s||s.focus()}};return(0,a.jsx)("div",{className:"flex items-center justify-center h-screen bg-background",children:(0,a.jsx)(eM,{className:"w-full max-w-sm",children:(()=>{switch(n){case"phone":return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(eE,{children:[(0,a.jsx)(eF,{children:"Welcome to SecureChat"}),(0,a.jsx)(eL,{children:"Enter your phone number to get started."})]}),(0,a.jsx)(eU,{children:(0,a.jsxs)("form",{onSubmit:w,children:[(0,a.jsx)("div",{className:"grid w-full items-center gap-4",children:(0,a.jsxs)("div",{className:"flex flex-col space-y-1.5",children:[(0,a.jsx)(e$,{htmlFor:"phone",children:"Phone Number"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(eq,{value:m,onValueChange:x,children:[(0,a.jsx)(eH,{className:"w-[100px]",children:(0,a.jsx)(eB,{placeholder:"Country"})}),(0,a.jsxs)(eX,{children:[(0,a.jsx)(eK,{value:"+1",children:"US +1"}),(0,a.jsx)(eK,{value:"+91",children:"IN +91"}),(0,a.jsx)(eK,{value:"+44",children:"GB +44"})]})]}),(0,a.jsx)(y,{id:"phone",placeholder:"555-555-5555",type:"tel",value:o,onChange:e=>u(e.target.value),required:!0})]})]})}),(0,a.jsxs)(b,{type:"submit",className:"w-full mt-4",disabled:d,children:[d&&(0,a.jsx)(eD.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Send OTP"]}),(0,a.jsx)("div",{id:"recaptcha-container",className:"mt-2"})]})})]});case"otp":return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(eE,{children:[(0,a.jsx)(b,{variant:"ghost",size:"icon",className:"absolute top-3 left-3",onClick:()=>i("phone"),children:(0,a.jsx)(G.A,{})}),(0,a.jsx)(eF,{className:"text-center",children:"Enter OTP"}),(0,a.jsxs)(eL,{className:"text-center",children:["We've sent a 6-digit code to ",m,o,"."]})]}),(0,a.jsx)(eU,{children:(0,a.jsxs)("form",{onSubmit:A,children:[(0,a.jsx)("div",{className:"flex justify-center gap-2 mb-4",children:f.map((e,s)=>(0,a.jsx)(y,{id:"otp-".concat(s),type:"text",maxLength:1,value:e,onChange:e=>k(s,e.target.value),onKeyDown:e=>T(s,e),className:"w-12 h-12 text-center text-2xl",required:!0},s))}),(0,a.jsxs)(b,{type:"submit",className:"w-full mt-4",disabled:d,children:[d&&(0,a.jsx)(eD.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Verify"]}),(0,a.jsx)("div",{className:"text-center mt-4",children:(0,a.jsx)(b,{variant:"link",size:"sm",type:"button",onClick:e=>w(e),children:"Resend OTP"})})]})})]});case"profile":return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(eE,{children:[(0,a.jsx)(b,{variant:"ghost",size:"icon",className:"absolute top-3 left-3",onClick:()=>i("otp"),children:(0,a.jsx)(G.A,{})}),(0,a.jsx)(eF,{className:"text-center",children:"Set up your profile"}),(0,a.jsx)(eL,{className:"text-center",children:"Add your name and an optional profile picture."})]}),(0,a.jsx)(eU,{children:(0,a.jsxs)("form",{onSubmit:S,children:[(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(R,{className:"w-24 h-24 text-6xl",children:[(0,a.jsx)(P,{src:null!=j?j:void 0}),(0,a.jsx)(I,{children:(0,a.jsx)(e_.A,{})})]}),(0,a.jsx)(b,{type:"button",size:"icon",variant:"secondary",className:"absolute bottom-0 right-0 rounded-full",onClick:()=>{var e;return null===(e=N.current)||void 0===e?void 0:e.click()},children:(0,a.jsx)(eT.A,{className:"w-4 h-4"})}),(0,a.jsx)("input",{type:"file",ref:N,className:"hidden",accept:"image/*",onChange:C})]}),(0,a.jsxs)("div",{className:"w-full space-y-1.5",children:[(0,a.jsx)(e$,{htmlFor:"name",children:"Your Name"}),(0,a.jsx)(y,{id:"name",placeholder:"John Doe",value:p,onChange:e=>g(e.target.value),required:!0})]})]}),(0,a.jsxs)(b,{type:"submit",className:"w-full mt-6",disabled:d,children:[d&&(0,a.jsx)(eD.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Save and Continue"]})]})})]})}})()})})}function e2(){let{user:e,isLoading:s,logout:t}=(0,r.A)();return s?(0,a.jsx)("div",{className:"flex h-screen w-full items-center justify-center",children:(0,a.jsx)(eD.A,{className:"h-12 w-12 animate-spin"})}):e?(0,a.jsx)(eO,{onSignOut:()=>{t()}}):(0,a.jsx)(e1,{})}},6079:(e,s,t)=>{"use strict";t.d(s,{A:()=>d,AuthProvider:()=>i});var a=t(5155),r=t(2115),l=t(5534);let n=(0,r.createContext)(void 0);function i(e){let{children:s}=e,[t,i]=(0,r.useState)(null),[d,c]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let e=localStorage.getItem("user");e&&i(JSON.parse(e)),c(!1)},[]);let o=async e=>{c(!0);try{let s=await l.F.users.login(e);i(s),localStorage.setItem("user",JSON.stringify(s))}catch(e){throw console.error("Login failed",e),e}finally{c(!1)}},u=async(e,s,t)=>{c(!0);try{await l.F.users.register(e,s,t);let a={id:e,username:s,profilePicture:t||void 0};i(a),localStorage.setItem("user",JSON.stringify(a))}catch(e){throw console.error("Registration failed",e),e}finally{c(!1)}};return(0,a.jsx)(n.Provider,{value:{user:t,isLoading:d,login:o,register:u,logout:()=>{i(null),localStorage.removeItem("user")}},children:s})}function d(){let e=(0,r.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},5564:(e,s,t)=>{"use strict";t.d(s,{dj:()=>m});var a=t(2115);let r=0,l=new Map,n=e=>{if(l.has(e))return;let s=setTimeout(()=>{l.delete(e),o({type:"REMOVE_TOAST",toastId:e})},1e6);l.set(e,s)},i=(e,s)=>{switch(s.type){case"ADD_TOAST":return{...e,toasts:[s.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===s.toast.id?{...e,...s.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=s;return t?n(t):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===s.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==s.toastId)}}},d=[],c={toasts:[]};function o(e){c=i(c,e),d.forEach(e=>{e(c)})}function u(e){let{...s}=e,t=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>o({type:"DISMISS_TOAST",toastId:t});return o({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:e=>{e||a()}}}),{id:t,dismiss:a,update:e=>o({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function m(){let[e,s]=a.useState(c);return a.useEffect(()=>(d.push(s),()=>{let e=d.indexOf(s);e>-1&&d.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>o({type:"DISMISS_TOAST",toastId:e})}}},5534:(e,s,t)=>{"use strict";async function a(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t="".concat("http://localhost/securechat/api/index.php","/").concat(e),a=await fetch(t,{...s,headers:{"Content-Type":"application/json",...s.headers}});if(!a.ok)throw Error((await a.json().catch(()=>({message:"An error occurred"}))).message||"API request failed");return a.json()}t.d(s,{F:()=>r});let r={users:{getAll:()=>a("users"),login:e=>a("users",{method:"POST",body:JSON.stringify({action:"login",id:e})}),register:(e,s,t)=>a("users",{method:"POST",body:JSON.stringify({action:"register",id:e,username:s,profile_picture:t})}),update:(e,s,t)=>a("users",{method:"PUT",body:JSON.stringify({id:e,username:s,profilePicture:t})})},chats:{getAll:e=>a("chats?user_id=".concat(e)),create:e=>a("chats",{method:"POST",body:JSON.stringify(e)})},messages:{getByChatId:e=>a("messages?chat_id=".concat(e)),send:e=>a("messages",{method:"POST",body:JSON.stringify(e)})},ai:{generate:e=>a("ai",{method:"POST",body:JSON.stringify({prompt:e})})}}},1567:(e,s,t)=>{"use strict";t.d(s,{cn:()=>l});var a=t(3463),r=t(9795);function l(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,r.QP)((0,a.$)(s))}}},e=>{var s=s=>e(e.s=s);e.O(0,[587,861,441,517,358],()=>s(2019)),_N_E=e.O()}]);